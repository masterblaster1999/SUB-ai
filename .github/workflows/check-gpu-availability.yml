name: Check GPU/CUDA Availability

on:
  workflow_dispatch:

jobs:
  check-hardware:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check CPU Info
      run: |
        echo "=== CPU Information ==="
        lscpu
        echo ""
        echo "CPU cores: $(nproc)"
        echo ""
    
    - name: Check GPU/CUDA Availability
      run: |
        echo "=== GPU/CUDA Check ==="
        echo ""
        
        # Check for NVIDIA GPU
        if command -v nvidia-smi &> /dev/null; then
            echo "✅ NVIDIA GPU detected!"
            nvidia-smi
        else
            echo "❌ No NVIDIA GPU available"
            echo "GitHub Actions free runners do NOT have GPUs"
        fi
        
        echo ""
        
        # Check CUDA
        if command -v nvcc &> /dev/null; then
            echo "✅ CUDA detected!"
            nvcc --version
        else
            echo "❌ No CUDA toolkit installed"
        fi
        
        echo ""
    
    - name: Check PyTorch CUDA Support
      run: |
        echo "=== PyTorch CUDA Check ==="
        python3 -m pip install --quiet torch
        
        python3 << 'EOF'
import torch
import sys

print(f"PyTorch version: {torch.__version__}")
print(f"CUDA available: {torch.cuda.is_available()}")

if torch.cuda.is_available():
    print(f"✅ CUDA is available!")
    print(f"CUDA version: {torch.version.cuda}")
    print(f"GPU count: {torch.cuda.device_count()}")
    for i in range(torch.cuda.device_count()):
        print(f"GPU {i}: {torch.cuda.get_device_name(i)}")
else:
    print(f"❌ CUDA is NOT available")
    print(f"\n⚠️  GitHub Actions free runners do NOT have GPUs!")
    print(f"\nYour model is training on CPU only, which is VERY slow.")
    print(f"\nOptions:")
    print(f"1. Use GitHub Actions GPU runners (paid)")
    print(f"2. Train locally with GPU")
    print(f"3. Use Google Colab (free GPU)")
    print(f"4. Use Kaggle (free GPU)")
    print(f"5. Reduce model size/samples for CPU training")
EOF
    
    - name: Summary
      run: |
        echo ""
        echo "====================================="
        echo "SUMMARY: GitHub Actions Free Tier"
        echo "====================================="
        echo ""
        echo "❌ No GPU/CUDA available"
        echo "❌ Training happens on CPU only"
        echo "⏱️  CPU training is 10-50x slower than GPU"
        echo ""
        echo "This is why your training takes 4+ hours!"
        echo ""
        echo "Recommendations:"
        echo "1. Train on Google Colab (Free GPU): https://colab.research.google.com/"
        echo "2. Train on Kaggle (Free GPU): https://www.kaggle.com/"
        echo "3. Train locally if you have NVIDIA GPU"
        echo "4. Use much smaller model (e.g., fewer layers)"
        echo ""
